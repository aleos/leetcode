name: Test and Coverage

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  test:
    runs-on: macos-26
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run Tests with Coverage
        run: |
          cd swift
          swift test --enable-code-coverage

      - name: Report Coverage
        run: |
          cd swift
          # Locate the test binary and profile data based on Package.swift targets
          XCTEST_PATH=$(swift build --show-bin-path)/LeetCodePackageTests.xctest/Contents/MacOS/LeetCodePackageTests
          PROFDATA_PATH=$(find .build -name "default.profdata")

          # Output the coverage report for the LeetCode module to CI logs
          xcrun llvm-cov report $XCTEST_PATH -instr-profile=$PROFDATA_PATH -ignore-filename-regex=".build|Tests"
